<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ thống Quản lý Đơn hàng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body class="bg-gray-50">
    <!-- Loading Overlay -->
    <div id="loadingOverlay"
        class="fixed inset-0 bg-gray-800/70 backdrop-blur-sm z-50 flex justify-center items-center hidden transition-opacity duration-300">
        <div class="bg-white p-6 rounded-xl shadow-2xl flex flex-col items-center animate-pulse">
            <div class="text-blue-600 mb-4">
                <i class="fas fa-circle-notch fa-spin text-5xl"></i>
            </div>
            <p class="text-gray-700 font-medium text-lg" id="loadingText">Đang xử lý...</p>
        </div>
    </div>

    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-blue-600 text-white shadow-lg sticky top-0 z-40">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <!-- Nút hiển thị sidebar cho thiết bị di động -->
                    <button id="mobileSidebarToggle" class="mr-2 md:hidden text-white">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h1 class="text-xl font-bold">Hệ Thống Quản Lý Đơn Hàng</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button type="button" id="resetFormBtn"
                        class="bg-white text-blue-600 px-4 py-2 rounded-lg font-medium hover:bg-blue-50 transition duration-300">
                        <i class="fas fa-redo-alt mr-2"></i><span class="hidden sm:inline">Làm mới</span>
                    </button>
                    <button id="saveAll"
                        class="bg-white text-blue-600 px-4 py-2 rounded-lg font-medium hover:bg-blue-50 transition duration-300">
                        <i class="fas fa-save mr-2"></i><span class="hidden sm:inline">Lưu</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content with Sidebar -->
        <div class="flex flex-grow relative">
            <!-- Overlay cho thiết bị di động khi sidebar mở -->
            <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"></div>

            <!-- Sidebar - Fixed position -->
            <div id="sidebar"
                class="w-80 bg-white border-r border-gray-200 overflow-hidden transition-all duration-300 fixed md:sticky top-0 z-30 h-screen transform -translate-x-full md:translate-x-0">
                <div class="p-4 border-b border-gray-200 flex justify-between items-center sticky top-0 bg-white z-10">
                    <h2 class="font-semibold text-gray-700">Danh Mục Sản Phẩm</h2>
                    <button id="toggleSidebar" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <!-- Nút đóng cho thiết bị di động -->
                    <button id="closeMobileSidebar" class="text-gray-500 hover:text-gray-700 md:hidden">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="overflow-y-auto" style="height: calc(100vh - 70px);">
                    <!-- Search Bar -->
                    <div class="p-4 border-b border-gray-200">
                        <div class="relative">
                            <input type="text" id="productSearch"
                                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="Tìm kiếm hàng hóa...">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                    </div>

                    <!-- Product Categories -->
                    <div class="p-4 border-b border-gray-200">
                        <div class="flex justify-between items-center cursor-pointer" id="categoryHeader">
                            <h3 class="font-medium text-sm text-gray-500 uppercase">Phân Loại</h3>
                            <button class="text-gray-500 focus:outline-none">
                                <i class="fas fa-chevron-down" id="categoryToggleIcon"></i>
                            </button>
                        </div>
                        <div id="categoryContent" class="mt-2 max-h-24 overflow-y-auto">
                            <div id="categoryContainer" class="flex flex-wrap gap-2">
                                <!-- Các nút phân loại sẽ được thêm động bằng JavaScript -->
                                <button class="px-3 py-1 rounded bg-blue-500 text-white font-medium category-filter"
                                    data-category="all">Tất cả</button>
                                <!-- Các phân loại khác sẽ được thêm từ dữ liệu -->
                            </div>
                            <div class="mt-2 text-xs text-blue-500 cursor-pointer" id="showAllCategories">
                                <span>Xem tất cả phân loại</span>
                            </div>
                        </div>
                    </div>

                    <!-- Product List -->
                    <div class="p-4">
                        <ul id="productList" class="divide-y divide-gray-200">
                            <!-- Product items will be dynamically loaded here -->
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Toggle button for collapsed sidebar -->
            <div id="sidebarCollapsed" class="hidden md:block">
                <button id="expandSidebar"
                    class="fixed left-0 top-1/2 transform -translate-y-1/2 bg-white p-2 rounded-r-lg shadow-md text-gray-500 hover:text-gray-700 border border-l-0 border-gray-200 z-10">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <!-- Main Content -->
            <main class="flex-grow w-full md:w-auto">
                <div class="container mx-auto px-4 py-6">
                    <!-- Thông tin khách hàng -->
                    <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                        <h2 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                            <i class="fas fa-user mr-2 text-blue-500"></i>
                            Thông tin khách hàng
                        </h2>

                        <form id="donHangForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                            <div class="form-group">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Mã đơn hàng</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                        <i class="fas fa-barcode text-gray-400"></i>
                                    </div>
                                    <input type="text" id="maDonHang"
                                        class="w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50"
                                        readonly>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Khách hàng <span
                                        class="text-red-500">*</span></label>
                                <div class="flex gap-2">
                                    <div class="relative flex-1">
                                        <div
                                            class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                            <i class="fas fa-user text-gray-400"></i>
                                        </div>
                                        <select id="khachHang"
                                            class="w-full pl-10 pr-9 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
                                            required>
                                            <option value="">-- Chọn khách hàng --</option>
                                        </select>
                                        <div
                                            class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                            <i class="fas fa-chevron-down text-gray-400"></i>
                                        </div>
                                    </div>
                                    <button type="button" id="btnThemKhachHang"
                                        class="px-3 py-2.5 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ngày bán <span
                                        class="text-red-500">*</span></label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                        <i class="fas fa-calendar-alt text-gray-400"></i>
                                    </div>
                                    <input type="date" id="ngayDatHang"
                                        class="w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nhân viên bán hàng</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                        <i class="fas fa-user-tie text-gray-400"></i>
                                    </div>
                                    <select id="nhanVienBanHang"
                                        class="w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">-- Chọn nhân viên --</option>
                                        <!-- Các option sẽ được tải động từ API -->
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ghi chú</label>
                                <div class="relative">
                                    <div class="absolute top-3 left-3 pointer-events-none">
                                        <i class="fas fa-sticky-note text-gray-400"></i>
                                    </div>
                                    <select id="ghiChu"
                                        class="w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="QUA NHÀ LẤY">QUA NHÀ LẤY</option>
                                        <option value="GỬI HÀNG TK">GỬI HÀNG TK</option>
                                        <option value="KO THU TIỀN">KO THU TIỀN</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ngày giao hàng dự
                                    kiến</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                        <i class="fas fa-calendar-alt text-gray-400"></i>
                                    </div>
                                    <input type="date" id="ngayGiaoHangDuKien"
                                        class="w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Chi tiết hàng hóa -->
                    <div id="chiTietSection" class="bg-white rounded-xl shadow-md p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-lg font-semibold text-gray-700 flex items-center">
                                <i class="fas fa-table-list mr-2 text-blue-500"></i>
                                Chi tiết hàng hóa
                            </h2>
                        </div>

                        <div class="overflow-x-auto rounded-lg border border-gray-200">
                            <table id="chiTietTable" class="min-w-full divide-y divide-gray-200">
                                <thead id="chiTietTableHead">
                                    <tr class="bg-gray-50">
                                        <th
                                            class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            STT</th>
                                        <th
                                            class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            SKU</th>
                                        <th
                                            class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Tên sản phẩm</th>
                                        <th
                                            class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            ĐVT</th>
                                        <th
                                            class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Số lượng</th>
                                        <th
                                            class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Đơn giá</th>
                                        <th
                                            class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Thành tiền</th>
                                        <th
                                            class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Phân loại giá</th>
                                        <th
                                            class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Ghi chú</th>
                                        <th
                                            class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody id="chiTietTableBody" class="bg-white divide-y divide-gray-200">
                                    <!-- Các dòng sẽ được thêm qua JavaScript -->
                                </tbody>
                            </table>
                        </div>

                        <div class="flex justify-between items-center mt-6">
                            <span id="dataStatusText" class="text-sm text-gray-500"></span>
                            <div class="flex space-x-3">
                                <button type="button" id="cancelBtn"
                                    class="px-4 py-2.5 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-200 flex items-center">
                                    <i class="fas fa-times mr-2"></i> Hủy
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Tổng hợp đơn hàng và thanh toán -->
                    <div id="paymentSummarySection" class="bg-white rounded-xl shadow-md p-6 mb-6">
                        <h2 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                            <i class="fas fa-calculator mr-2 text-blue-500"></i>
                            Thông tin thanh toán
                        </h2>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="grid grid-cols-1 gap-4">
                                <!-- Các trường thanh toán đã chuyển từ phần trên -->
                                <div class="form-group">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Phân loại giảm
                                        giá</label>
                                    <div class="relative">
                                        <div
                                            class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                            <i class="fas fa-tags text-gray-400"></i>
                                        </div>
                                        <select id="phanLoaiGiamGia"
                                            class="w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="Không giảm giá">Không giảm giá</option>
                                            <option value="Giảm giá theo tiền">Theo tiền</option>
                                            <option value="Giảm giá theo phần trăm">Theo phần trăm</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Giảm giá theo
                                        tiền</label>
                                    <div class="relative">
                                        <div
                                            class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                            <i class="fas fa-money-bill-wave text-gray-400"></i>
                                        </div>
                                        <input type="text" id="giamGiaTheoTien"
                                            class="w-full pl-10 pr-10 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            value="0">
                                        <div
                                            class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                            <span class="text-gray-500 text-sm">VNĐ</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Giảm giá theo %</label>
                                    <div class="relative">
                                        <div
                                            class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                            <i class="fas fa-percent text-gray-400"></i>
                                        </div>
                                        <input type="number" id="giamGiaTheoPhanTram"
                                            class="w-full pl-10 pr-8 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            value="0" min="0" max="100">
                                        <div
                                            class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                            <span class="text-gray-500 text-sm">%</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Đã thanh toán</label>
                                    <div class="relative">
                                        <div
                                            class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                            <i class="fas fa-check-circle text-gray-400"></i>
                                        </div>
                                        <input type="text" id="daThanhToan"
                                            class="w-full pl-10 pr-10 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            value="0">
                                        <div
                                            class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                            <span class="text-gray-500 text-sm">VNĐ</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Trạng thái</label>
                                    <div class="relative">
                                        <div
                                            class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                            <i class="fas fa-clipboard-check text-gray-400"></i>
                                        </div>
                                        <select id="trangThai"
                                            class="w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="Chốt order">Chốt order</option>
                                            <option value="Giao thành công">Giao thành công</option>
                                            <option value="Đơn hàng chờ xử lý">Đơn hàng chờ xử lý</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Phương thức thanh
                                        toán</label>
                                    <div class="relative">
                                        <div
                                            class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                            <i class="fas fa-credit-card text-gray-400"></i>
                                        </div>
                                        <select id="phuongThucThanhToan"
                                            class="w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="ĐÃ THANH TOÁN">ĐÃ THANH TOÁN</option>
                                            <option value="CÔNG NỢ">CÔNG NỢ</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Hình thức thanh
                                        toán</label>
                                    <div class="relative">
                                        <div
                                            class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                            <i class="fas fa-money-bill text-gray-400"></i>
                                        </div>
                                        <select id="paymentMethod"
                                            class="w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="Tiền mặt">Tiền mặt</option>
                                            <option value="Chuyển khoản">Chuyển khoản</option>
                                            <option value="Thẻ tín dụng">Thẻ tín dụng</option>
                                            <option value="Ví điện tử">Ví điện tử</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Ghi chú thanh
                                        toán</label>
                                    <textarea id="paymentNote"
                                        class="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        rows="3" placeholder="Ghi chú về thanh toán..."></textarea>
                                </div>
                            </div>

                            <div>
                                <div class="bg-gray-50 p-4 rounded-lg mb-4">
                                    <div class="form-group mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Tổng tiền
                                            hàng</label>
                                        <div class="relative">
                                            <div
                                                class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                                <i class="fas fa-money-bill-wave text-gray-400"></i>
                                            </div>
                                            <input type="text" id="tongTienHang"
                                                class="w-full pl-10 pr-10 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50"
                                                readonly>
                                            <div
                                                class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                                <span class="text-gray-500 text-sm">VNĐ</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Phí ship</label>
                                        <div class="relative">
                                            <div
                                                class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                                <i class="fas fa-truck text-gray-400"></i>
                                            </div>
                                            <select id="phiShip"
                                                class="w-full pl-10 pr-10 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                <option value="10000">10,000</option>
                                                <option value="15000">15,000</option>
                                                <option value="20000">20,000</option>
                                            </select>
                                            <div
                                                class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                                <span class="text-gray-500 text-sm">VNĐ</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Giảm giá</label>
                                        <div class="relative">
                                            <div
                                                class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                                <i class="fas fa-tag text-gray-400"></i>
                                            </div>
                                            <input type="text" id="giamGia"
                                                class="w-full pl-10 pr-10 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50"
                                                value="0" readonly>
                                            <div
                                                class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                                <span class="text-gray-500 text-sm">VNĐ</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Còn phải thanh
                                            toán</label>
                                        <div class="relative">
                                            <div
                                                class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                                <i class="fas fa-coins text-gray-400"></i>
                                            </div>
                                            <input type="text" id="conlaiPhaithanhtoan"
                                                class="w-full pl-10 pr-10 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 font-bold text-lg"
                                                readonly>
                                            <div
                                                class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                                <span class="text-gray-500 text-sm">VNĐ</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <div class="flex justify-between py-2 border-b border-gray-200">
                                        <span class="text-gray-600">Tổng tiền hàng:</span>
                                        <span id="totalBeforeDiscount" class="font-medium">0 đ</span>
                                    </div>
                                    <div class="flex justify-between py-2 border-b border-gray-200">
                                        <span class="text-gray-600">Giảm giá:</span>
                                        <span id="totalDiscount" class="font-medium text-red-500">0 đ</span>
                                    </div>
                                    <div class="flex justify-between py-2 border-b border-gray-200">
                                        <span class="text-gray-600">Phí giao hàng:</span>
                                        <span id="shippingFeeDisplay" class="font-medium">0 đ</span>
                                    </div>
                                    <div class="flex justify-between py-2 border-b border-gray-200">
                                        <span class="text-gray-600">Đã thanh toán:</span>
                                        <span id="paidAmountDisplay" class="font-medium">0 đ</span>
                                    </div>
                                    <div class="flex justify-between py-3 font-bold text-lg">
                                        <span class="text-gray-800">CÒN PHẢI THANH TOÁN:</span>
                                        <span id="remainingTotal" class="text-blue-600">0 đ</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal Thêm Khách Hàng -->
    <div id="themKhachHangModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <!-- Overlay -->
            <div class="fixed inset-0 bg-black opacity-50 transition-opacity" id="modalOverlay"></div>

            <!-- Modal content -->
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full z-10 relative">
                <div class="flex justify-between items-center border-b px-6 py-4">
                    <h3 class="text-lg font-medium text-gray-900">Thêm khách hàng mới</h3>
                    <button id="closeKhachHangModal" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="p-6">
                    <form id="khachHangForm">
                        <div class="space-y-4">
                            <div class="form-group">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Tên khách hàng <span
                                        class="text-red-500">*</span></label>
                                <input type="text" id="tenKhachHang"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    required>
                            </div>

                            <div class="form-group">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Số điện thoại <span
                                        class="text-red-500">*</span></label>
                                <input type="tel" id="soDienThoai"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    required>
                            </div>

                            <div class="form-group">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Địa chỉ</label>
                                <input type="text" id="diaChi"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>

                            <div class="form-group">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input type="email" id="email"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <div class="mt-6 flex justify-end space-x-3">
                            <button type="button" id="cancelKhachHangBtn"
                                class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-200">
                                Hủy
                            </button>
                            <button type="submit" id="saveKhachHangBtn"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-200">
                                Lưu
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize date fields with current date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('ngayDatHang').value = today;
            document.getElementById('ngayGiaoHangDuKien').value = today;

            // Generate a random order ID
            function generateOrderId() {
                const prefix = 'DH';
                const timestamp = Date.now().toString().slice(-6);
                const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                return `${prefix}${timestamp}${random}`;
            }
            document.getElementById('maDonHang').value = generateOrderId();

            // Sidebar toggle functionality
            const sidebar = document.getElementById('sidebar');
            const sidebarCollapsed = document.getElementById('sidebarCollapsed');
            const toggleSidebar = document.getElementById('toggleSidebar');
            const expandSidebar = document.getElementById('expandSidebar');
            const mobileSidebarToggle = document.getElementById('mobileSidebarToggle');
            const closeMobileSidebar = document.getElementById('closeMobileSidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            toggleSidebar.addEventListener('click', function () {
                sidebar.classList.add('transform', '-translate-x-full');
                sidebar.classList.remove('md:translate-x-0');
                sidebarCollapsed.classList.remove('hidden');
            });

            expandSidebar.addEventListener('click', function () {
                sidebar.classList.remove('transform', '-translate-x-full');
                sidebar.classList.add('md:translate-x-0');
                sidebarCollapsed.classList.add('hidden');
            });

            mobileSidebarToggle.addEventListener('click', function () {
                sidebar.classList.remove('-translate-x-full');
                sidebarOverlay.classList.remove('hidden');
            });

            closeMobileSidebar.addEventListener('click', function () {
                sidebar.classList.add('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            });

            sidebarOverlay.addEventListener('click', function () {
                sidebar.classList.add('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            });

            // Category toggle
            const categoryHeader = document.getElementById('categoryHeader');
            const categoryContent = document.getElementById('categoryContent');
            const categoryToggleIcon = document.getElementById('categoryToggleIcon');

            categoryHeader.addEventListener('click', function () {
                categoryContent.classList.toggle('hidden');
                categoryToggleIcon.classList.toggle('fa-chevron-down');
                categoryToggleIcon.classList.toggle('fa-chevron-up');
            });

            // Modal functionality
            const themKhachHangModal = document.getElementById('themKhachHangModal');
            const btnThemKhachHang = document.getElementById('btnThemKhachHang');
            const closeKhachHangModal = document.getElementById('closeKhachHangModal');
            const cancelKhachHangBtn = document.getElementById('cancelKhachHangBtn');
            const modalOverlay = document.getElementById('modalOverlay');

            btnThemKhachHang.addEventListener('click', function () {
                themKhachHangModal.classList.remove('hidden');
            });

            function closeModal() {
                themKhachHangModal.classList.add('hidden');
            }

            closeKhachHangModal.addEventListener('click', closeModal);
            cancelKhachHangBtn.addEventListener('click', closeModal);
            modalOverlay.addEventListener('click', closeModal);

            // Form submission
            const khachHangForm = document.getElementById('khachHangForm');
            khachHangForm.addEventListener('submit', function (e) {
                e.preventDefault();
                // Here you would typically send the data to your backend
                // For demo purposes, we'll just close the modal
                closeModal();
            });

            // Discount type change handler
            const phanLoaiGiamGia = document.getElementById('phanLoaiGiamGia');
            const giamGiaTheoTien = document.getElementById('giamGiaTheoTien');
            const giamGiaTheoPhanTram = document.getElementById('giamGiaTheoPhanTram');

            phanLoaiGiamGia.addEventListener('change', function () {
                if (this.value === 'Không giảm giá') {
                    giamGiaTheoTien.disabled = true;
                    giamGiaTheoPhanTram.disabled = true;
                    giamGiaTheoTien.value = '0';
                    giamGiaTheoPhanTram.value = '0';
                } else if (this.value === 'Giảm giá theo tiền') {
                    giamGiaTheoTien.disabled = false;
                    giamGiaTheoPhanTram.disabled = true;
                    giamGiaTheoPhanTram.value = '0';
                } else {
                    giamGiaTheoTien.disabled = true;
                    giamGiaTheoPhanTram.disabled = false;
                    giamGiaTheoTien.value = '0';
                }
                updateTotals();
            });

            // Initialize choices.js for select elements
            const selectElements = document.querySelectorAll('select');
            selectElements.forEach(element => {
                if (element.id !== 'khachHang') { // Skip customer select as it might need special handling
                    new Choices(element, {
                        searchEnabled: false,
                        itemSelectText: '',
                        shouldSort: false,
                        position: 'bottom'
                    });
                }
            });

            // Mock data for product list
            const mockProducts = [
                { id: 1, sku: 'SKU001', name: 'Áo thun nam', category: 'Áo', price: 150000, unit: 'Cái' },
                { id: 2, sku: 'SKU002', name: 'Quần jean nữ', category: 'Quần', price: 350000, unit: 'Cái' },
                { id: 3, sku: 'SKU003', name: 'Giày thể thao', category: 'Giày', price: 450000, unit: 'Đôi' },
                { id: 4, sku: 'SKU004', name: 'Túi xách nữ', category: 'Túi', price: 250000, unit: 'Cái' },
                { id: 5, sku: 'SKU005', name: 'Đồng hồ nam', category: 'Phụ kiện', price: 550000, unit: 'Cái' },
                { id: 6, sku: 'SKU006', name: 'Ví da', category: 'Phụ kiện', price: 180000, unit: 'Cái' },
                { id: 7, sku: 'SKU007', name: 'Áo khoác nữ', category: 'Áo', price: 450000, unit: 'Cái' },
                { id: 8, sku: 'SKU008', name: 'Quần short nam', category: 'Quần', price: 200000, unit: 'Cái' }
            ];

            // Populate product list
            const productList = document.getElementById('productList');
            const categoryContainer = document.getElementById('categoryContainer');
            const categories = new Set(['all']);

            mockProducts.forEach(product => {
                categories.add(product.category);

                const listItem = document.createElement('li');
                listItem.className = 'py-3 flex justify-between items-center hover:bg-gray-50 px-2 rounded-lg cursor-pointer product-item';
                listItem.dataset.id = product.id;
                listItem.dataset.category = product.category;
                listItem.innerHTML = `
                <div>
                    <h4 class="font-medium text-gray-800">${product.name}</h4>
                    <div class="text-sm text-gray-500">SKU: ${product.sku}</div>
                </div>
                <div class="text-right">
                    <div class="font-medium text-gray-900">${formatCurrency(product.price)}</div>
                    <div class="text-xs text-gray-500">${product.unit}</div>
                </div>
            `;
                productList.appendChild(listItem);

                // Add click event to add product to order
                listItem.addEventListener('click', function () {
                    addProductToOrder(product);
                });
            });

            // Populate categories
            categories.forEach(category => {
                if (category !== 'all') {
                    const button = document.createElement('button');
                    button.className = 'px-3 py-1 rounded bg-gray-200 text-gray-700 font-medium category-filter';
                    button.dataset.category = category;
                    button.textContent = category;
                    categoryContainer.appendChild(button);

                    // Add click event for category filtering
                    button.addEventListener('click', function () {
                        filterProductsByCategory(category);
                        document.querySelectorAll('.category-filter').forEach(btn => {
                            btn.classList.remove('bg-blue-500', 'text-white');
                            btn.classList.add('bg-gray-200', 'text-gray-700');
                        });
                        this.classList.remove('bg-gray-200', 'text-gray-700');
                        this.classList.add('bg-blue-500', 'text-white');
                    });
                }
            });

            // Set "All" category as active by default
            document.querySelector('.category-filter[data-category="all"]').addEventListener('click', function () {
                filterProductsByCategory('all');
                document.querySelectorAll('.category-filter').forEach(btn => {
                    btn.classList.remove('bg-blue-500', 'text-white');
                    btn.classList.add('bg-gray-200', 'text-gray-700');
                });
                this.classList.remove('bg-gray-200', 'text-gray-700');
                this.classList.add('bg-blue-500', 'text-white');
            });

            // Filter products by category
            function filterProductsByCategory(category) {
                const productItems = document.querySelectorAll('.product-item');
                productItems.forEach(item => {
                    if (category === 'all' || item.dataset.category === category) {
                        item.classList.remove('hidden');
                    } else {
                        item.classList.add('hidden');
                    }
                });
            }

            // Product search functionality
            const productSearch = document.getElementById('productSearch');
            productSearch.addEventListener('input', function () {
                const searchTerm = this.value.toLowerCase();
                const productItems = document.querySelectorAll('.product-item');

                productItems.forEach(item => {
                    const productName = item.querySelector('h4').textContent.toLowerCase();
                    const productSku = item.querySelector('.text-sm').textContent.toLowerCase();

                    if (productName.includes(searchTerm) || productSku.includes(searchTerm)) {
                        item.classList.remove('hidden');
                    } else {
                        item.classList.add('hidden');
                    }
                });
            });

            // Add product to order
            let orderItems = [];
            const chiTietTableBody = document.getElementById('chiTietTableBody');

            function addProductToOrder(product) {
                // Check if product already exists in order
                const existingItem = orderItems.find(item => item.id === product.id);

                if (existingItem) {
                    existingItem.quantity += 1;
                    existingItem.total = existingItem.quantity * existingItem.price;
                } else {
                    orderItems.push({
                        id: product.id,
                        sku: product.sku,
                        name: product.name,
                        unit: product.unit,
                        quantity: 1,
                        price: product.price,
                        total: product.price,
                        priceType: 'Giá bán lẻ',
                        note: ''
                    });
                }

                renderOrderItems();
                updateTotals();
            }

            // Render order items in table
            function renderOrderItems() {
                chiTietTableBody.innerHTML = '';

                orderItems.forEach((item, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                    <td class="px-3 py-2 whitespace-nowrap">${index + 1}</td>
                    <td class="px-3 py-2 whitespace-nowrap">${item.sku}</td>
                    <td class="px-3 py-2">${item.name}</td>
                    <td class="px-3 py-2 whitespace-nowrap">${item.unit}</td>
                    <td class="px-3 py-2 whitespace-nowrap">
                        <div class="flex items-center">
                            <button class="quantity-decrease px-2 py-1 bg-gray-200 rounded-l-lg">-</button>
                            <input type="number" class="quantity-input w-12 text-center border-y border-gray-200 py-1" value="${item.quantity}" min="1">
                            <button class="quantity-increase px-2 py-1 bg-gray-200 rounded-r-lg">+</button>
                        </div>
                    </td>
                    <td class="px-3 py-2 whitespace-nowrap">${formatCurrency(item.price)}</td>
                    <td class="px-3 py-2 whitespace-nowrap">${formatCurrency(item.total)}</td>
                    <td class="px-3 py-2 whitespace-nowrap">
                        <select class="price-type border border-gray-300 rounded px-2 py-1 text-sm">
                            <option value="Giá bán lẻ" ${item.priceType === 'Giá bán lẻ' ? 'selected' : ''}>Giá bán lẻ</option>
                            <option value="Giá bán sỉ" ${item.priceType === 'Giá bán sỉ' ? 'selected' : ''}>Giá bán sỉ</option>
                        </select>
                    </td>
                    <td class="px-3 py-2">
                        <input type="text" class="item-note border border-gray-300 rounded px-2 py-1 w-full text-sm" value="${item.note}">
                    </td>
                    <td class="px-3 py-2 whitespace-nowrap text-center">
                        <button class="delete-item text-red-500 hover:text-red-700">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                    chiTietTableBody.appendChild(row);

                    // Add event listeners for quantity buttons
                    const decreaseBtn = row.querySelector('.quantity-decrease');
                    const increaseBtn = row.querySelector('.quantity-increase');
                    const quantityInput = row.querySelector('.quantity-input');
                    const deleteBtn = row.querySelector('.delete-item');
                    const priceTypeSelect = row.querySelector('.price-type');
                    const noteInput = row.querySelector('.item-note');

                    decreaseBtn.addEventListener('click', function () {
                        if (item.quantity > 1) {
                            item.quantity -= 1;
                            quantityInput.value = item.quantity;
                            item.total = item.quantity * item.price;
                            row.cells[6].textContent = formatCurrency(item.total);
                            updateTotals();
                        }
                    });

                    increaseBtn.addEventListener('click', function () {
                        item.quantity += 1;
                        quantityInput.value = item.quantity;
                        item.total = item.quantity * item.price;
                        row.cells[6].textContent = formatCurrency(item.total);
                        updateTotals();
                    });

                    quantityInput.addEventListener('change', function () {
                        const newQuantity = parseInt(this.value);
                        if (newQuantity > 0) {
                            item.quantity = newQuantity;
                            item.total = item.quantity * item.price;
                            row.cells[6].textContent = formatCurrency(item.total);
                            updateTotals();
                        } else {
                            this.value = item.quantity;
                        }
                    });

                    deleteBtn.addEventListener('click', function () {
                        orderItems = orderItems.filter(i => i.id !== item.id);
                        renderOrderItems();
                        updateTotals();
                    });

                    priceTypeSelect.addEventListener('change', function () {
                        item.priceType = this.value;
                        // Here you might adjust the price based on the price type
                    });

                    noteInput.addEventListener('input', function () {
                        item.note = this.value;
                    });
                });

                // Update data status text
                const dataStatusText = document.getElementById('dataStatusText');
                dataStatusText.textContent = `Tổng số ${orderItems.length} sản phẩm`;
            }

            // Update totals
            function updateTotals() {
                const tongTienHang = document.getElementById('tongTienHang');
                const giamGia = document.getElementById('giamGia');
                const conlaiPhaithanhtoan = document.getElementById('conlaiPhaithanhtoan');
                const daThanhToan = document.getElementById('daThanhToan');
                const phiShip = document.getElementById('phiShip');
                const giamGiaTheoTien = document.getElementById('giamGiaTheoTien');
                const giamGiaTheoPhanTram = document.getElementById('giamGiaTheoPhanTram');
                const phanLoaiGiamGia = document.getElementById('phanLoaiGiamGia');

                // Calculate total
                const total = orderItems.reduce((sum, item) => sum + item.total, 0);
                tongTienHang.value = formatCurrency(total, false);

                // Calculate discount
                let discountAmount = 0;
                if (phanLoaiGiamGia.value === 'Giảm giá theo tiền') {
                    discountAmount = parseFloat(giamGiaTheoTien.value.replace(/[^0-9.-]+/g, '')) || 0;
                } else if (phanLoaiGiamGia.value === 'Giảm giá theo phần trăm') {
                    const discountPercent = parseFloat(giamGiaTheoPhanTram.value) || 0;
                    discountAmount = (total * discountPercent) / 100;
                }
                giamGia.value = formatCurrency(discountAmount, false);

                // Calculate shipping fee
                const shippingFee = parseFloat(phiShip.value) || 0;

                // Calculate paid amount
                const paidAmount = parseFloat(daThanhToan.value.replace(/[^0-9.-]+/g, '')) || 0;

                // Calculate remaining amount
                const remainingAmount = total - discountAmount + shippingFee - paidAmount;
                conlaiPhaithanhtoan.value = formatCurrency(remainingAmount, false);

                // Update summary display
                document.getElementById('totalBeforeDiscount').textContent = formatCurrency(total);
                document.getElementById('totalDiscount').textContent = formatCurrency(discountAmount);
                document.getElementById('shippingFeeDisplay').textContent = formatCurrency(shippingFee);
                document.getElementById('paidAmountDisplay').textContent = formatCurrency(paidAmount);
                document.getElementById('remainingTotal').textContent = formatCurrency(remainingAmount);
            }

            // Format currency
            function formatCurrency(value, includeSymbol = true) {
                const formatter = new Intl.NumberFormat('vi-VN', {
                    style: includeSymbol ? 'currency' : 'decimal',
                    currency: 'VND',
                    minimumFractionDigits: 0
                });
                return formatter.format(value);
            }

            // Input event listeners for totals
            document.getElementById('giamGiaTheoTien').addEventListener('input', updateTotals);
            document.getElementById('giamGiaTheoPhanTram').addEventListener('input', updateTotals);
            document.getElementById('daThanhToan').addEventListener('input', updateTotals);
            document.getElementById('phiShip').addEventListener('change', updateTotals);

            // Reset form
            document.getElementById('resetFormBtn').addEventListener('click', function () {
                if (confirm('Bạn có chắc muốn làm mới form? Tất cả dữ liệu sẽ bị mất.')) {
                    document.getElementById('donHangForm').reset();
                    orderItems = [];
                    renderOrderItems();
                    updateTotals();
                    document.getElementById('maDonHang').value = generateOrderId();
                    document.getElementById('ngayDatHang').value = today;
                    document.getElementById('ngayGiaoHangDuKien').value = today;
                }
            });

            // Save order
            document.getElementById('saveAll').addEventListener('click', function () {
                const loadingOverlay = document.getElementById('loadingOverlay');
                loadingOverlay.classList.remove('hidden');

                // Simulate API call
                setTimeout(() => {
                    loadingOverlay.classList.add('hidden');
                    Swal.fire({
                        title: 'Thành công!',
                        text: 'Đơn hàng đã được lưu thành công.',
                        icon: 'success',
                        confirmButtonText: 'OK',
                        confirmButtonColor: '#3085d6'
                    }).then(() => {
                        // Reset form after successful save
                        document.getElementById('donHangForm').reset();
                        orderItems = [];
                        renderOrderItems();
                        updateTotals();
                        document.getElementById('maDonHang').value = generateOrderId();
                        document.getElementById('ngayDatHang').value = today;
                        document.getElementById('ngayGiaoHangDuKien').value = today;
                    });
                }, 1500);
            });

            // Cancel button
            document.getElementById('cancelBtn').addEventListener('click', function () {
                if (confirm('Bạn có chắc muốn hủy đơn hàng này?')) {
                    window.location.href = 'don-hang.html'; // Redirect to orders page
                }
            });

            // Initialize
            updateTotals();
        });
    </script>
</body>

</html>
